<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Git for Scientists</title>
  <meta name="description" content="Moving from spatial to 3D to VR using R">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Git for Scientists" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Moving from spatial to 3D to VR using R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Git for Scientists" />
  
  <meta name="twitter:description" content="Moving from spatial to 3D to VR using R" />
  

<meta name="author" content="Miles McBain, Michael Sumner">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="transforming-spatial-data-to-3d-forms.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="libs/rglwidgetClass-2/rgl.css" rel="stylesheet" />
<script src="libs/rglwidgetClass-2/rglClass.src.js"></script>
<script src="libs/CanvasMatrix4-2016/CanvasMatrix.src.js"></script>
<script src="libs/rglWebGL-binding-0.99.16/rglWebGL.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About this</a></li>
<li class="chapter" data-level="2" data-path="getting-set-up.html"><a href="getting-set-up.html"><i class="fa fa-check"></i><b>2</b> Getting Set Up</a></li>
<li class="chapter" data-level="3" data-path="why-vr-r.html"><a href="why-vr-r.html"><i class="fa fa-check"></i><b>3</b> Why VR + R</a><ul>
<li class="chapter" data-level="3.1" data-path="why-vr-r.html"><a href="why-vr-r.html#questions"><i class="fa fa-check"></i><b>3.1</b> Questions</a></li>
<li class="chapter" data-level="3.2" data-path="why-vr-r.html"><a href="why-vr-r.html#overview"><i class="fa fa-check"></i><b>3.2</b> Overview</a></li>
<li class="chapter" data-level="3.3" data-path="why-vr-r.html"><a href="why-vr-r.html#why-are-we-here"><i class="fa fa-check"></i><b>3.3</b> Why are we here?</a></li>
<li class="chapter" data-level="3.4" data-path="why-vr-r.html"><a href="why-vr-r.html#r-vr-for-science"><i class="fa fa-check"></i><b>3.4</b> R + VR for Science</a></li>
<li class="chapter" data-level="3.5" data-path="why-vr-r.html"><a href="why-vr-r.html#this-workshop"><i class="fa fa-check"></i><b>3.5</b> This Workshop:</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="intro-to-webvr.html"><a href="intro-to-webvr.html"><i class="fa fa-check"></i><b>4</b> Intro to WebVR</a><ul>
<li class="chapter" data-level="4.1" data-path="intro-to-webvr.html"><a href="intro-to-webvr.html#questions-1"><i class="fa fa-check"></i><b>4.1</b> Questions</a></li>
<li class="chapter" data-level="4.2" data-path="intro-to-webvr.html"><a href="intro-to-webvr.html#overview-1"><i class="fa fa-check"></i><b>4.2</b> Overview</a></li>
<li class="chapter" data-level="4.3" data-path="intro-to-webvr.html"><a href="intro-to-webvr.html#what-is-webvr"><i class="fa fa-check"></i><b>4.3</b> What is WebVR?</a></li>
<li class="chapter" data-level="4.4" data-path="intro-to-webvr.html"><a href="intro-to-webvr.html#creating-webvr-applications"><i class="fa fa-check"></i><b>4.4</b> Creating WebVR Applications</a></li>
<li class="chapter" data-level="4.5" data-path="intro-to-webvr.html"><a href="intro-to-webvr.html#check-out-a-frame"><i class="fa fa-check"></i><b>4.5</b> Check out A-Frame</a></li>
<li class="chapter" data-level="4.6" data-path="intro-to-webvr.html"><a href="intro-to-webvr.html#why-a-frame-is-awesome"><i class="fa fa-check"></i><b>4.6</b> Why A-Frame is Awesome</a></li>
<li class="chapter" data-level="4.7" data-path="intro-to-webvr.html"><a href="intro-to-webvr.html#the-a-frame-stack"><i class="fa fa-check"></i><b>4.7</b> The A-Frame Stack</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html"><i class="fa fa-check"></i><b>5</b> A-Frame Concepts</a><ul>
<li class="chapter" data-level="5.1" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#questions-2"><i class="fa fa-check"></i><b>5.1</b> Questions</a></li>
<li class="chapter" data-level="5.2" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#overview-2"><i class="fa fa-check"></i><b>5.2</b> Overview</a></li>
<li class="chapter" data-level="5.3" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#anatomy-of-an-a-frame-scene"><i class="fa fa-check"></i><b>5.3</b> Anatomy of an A-Frame Scene</a><ul>
<li class="chapter" data-level="5.3.1" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#open-an-a-frame-scene-on-glitch.com"><i class="fa fa-check"></i><b>5.3.1</b> Open an A-Frame scene on glitch.com</a></li>
<li class="chapter" data-level="5.3.2" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#the-header"><i class="fa fa-check"></i><b>5.3.2</b> The header</a></li>
<li class="chapter" data-level="5.3.3" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#the-scene"><i class="fa fa-check"></i><b>5.3.3</b> The scene</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#config-conventions"><i class="fa fa-check"></i><b>5.4</b> Config Conventions</a><ul>
<li class="chapter" data-level="5.4.1" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#coordinate-system"><i class="fa fa-check"></i><b>5.4.1</b> Coordinate system</a></li>
<li class="chapter" data-level="5.4.2" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#vectors"><i class="fa fa-check"></i><b>5.4.2</b> Vectors</a></li>
<li class="chapter" data-level="5.4.3" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#applying-rotation"><i class="fa fa-check"></i><b>5.4.3</b> Applying Rotation</a></li>
<li class="chapter" data-level="5.4.4" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#camera-position"><i class="fa fa-check"></i><b>5.4.4</b> Camera Position</a></li>
<li class="chapter" data-level="5.4.5" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#tweaking-a-scene"><i class="fa fa-check"></i><b>5.4.5</b> Tweaking a scene</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#entity-component-configuration"><i class="fa fa-check"></i><b>5.5</b> Entity component configuration</a><ul>
<li class="chapter" data-level="5.5.1" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#the-id"><i class="fa fa-check"></i><b>5.5.1</b> The <code>id</code></a></li>
<li class="chapter" data-level="5.5.2" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#switching-to-long-form"><i class="fa fa-check"></i><b>5.5.2</b> Switching to long form</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#a-frame-documentation"><i class="fa fa-check"></i><b>5.6</b> A-Frame Documentation</a></li>
<li class="chapter" data-level="5.7" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#lights-camera-actions-controls"><i class="fa fa-check"></i><b>5.7</b> Lights, Camera, Actions (controls)</a><ul>
<li class="chapter" data-level="5.7.1" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#lighting"><i class="fa fa-check"></i><b>5.7.1</b> Lighting</a></li>
<li class="chapter" data-level="5.7.2" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#lighting-it-up"><i class="fa fa-check"></i><b>5.7.2</b> Lighting it up</a></li>
<li class="chapter" data-level="5.7.3" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#cameras-and-controls"><i class="fa fa-check"></i><b>5.7.3</b> Cameras and Controls</a></li>
<li class="chapter" data-level="5.7.4" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#learn-to-fly"><i class="fa fa-check"></i><b>5.7.4</b> Learn to fly</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="a-frame-concepts.html"><a href="a-frame-concepts.html#summary"><i class="fa fa-check"></i><b>5.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="developing-with-a-frame.html"><a href="developing-with-a-frame.html"><i class="fa fa-check"></i><b>6</b> Developing with A-Frame</a><ul>
<li class="chapter" data-level="6.1" data-path="developing-with-a-frame.html"><a href="developing-with-a-frame.html#questions-3"><i class="fa fa-check"></i><b>6.1</b> Questions</a></li>
<li class="chapter" data-level="6.2" data-path="developing-with-a-frame.html"><a href="developing-with-a-frame.html#overview-3"><i class="fa fa-check"></i><b>6.2</b> Overview</a></li>
<li class="chapter" data-level="6.3" data-path="developing-with-a-frame.html"><a href="developing-with-a-frame.html#a-frame-dev-tools"><i class="fa fa-check"></i><b>6.3</b> A-Frame Dev Tools</a><ul>
<li class="chapter" data-level="6.3.1" data-path="developing-with-a-frame.html"><a href="developing-with-a-frame.html#browser-dev-tools"><i class="fa fa-check"></i><b>6.3.1</b> Browser Dev Tools</a></li>
<li class="chapter" data-level="6.3.2" data-path="developing-with-a-frame.html"><a href="developing-with-a-frame.html#a-frame-inspector"><i class="fa fa-check"></i><b>6.3.2</b> A-Frame Inspector</a></li>
<li class="chapter" data-level="6.3.3" data-path="developing-with-a-frame.html"><a href="developing-with-a-frame.html#aside-models-and-the-scaling-issue"><i class="fa fa-check"></i><b>6.3.3</b> Aside: Models and the scaling issue</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="developing-with-a-frame.html"><a href="developing-with-a-frame.html#common-patterns"><i class="fa fa-check"></i><b>6.4</b> Common Patterns</a><ul>
<li class="chapter" data-level="6.4.1" data-path="developing-with-a-frame.html"><a href="developing-with-a-frame.html#nesting-entities"><i class="fa fa-check"></i><b>6.4.1</b> Nesting entities</a></li>
<li class="chapter" data-level="6.4.2" data-path="developing-with-a-frame.html"><a href="developing-with-a-frame.html#interactivity"><i class="fa fa-check"></i><b>6.4.2</b> Interactivity</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="developing-with-a-frame.html"><a href="developing-with-a-frame.html#finally"><i class="fa fa-check"></i><b>6.5</b> Finally</a><ul>
<li class="chapter" data-level="6.5.1" data-path="developing-with-a-frame.html"><a href="developing-with-a-frame.html#working-with-a-frame-outside-of-glitch"><i class="fa fa-check"></i><b>6.5.1</b> Working with A-Frame outside of Glitch</a></li>
<li class="chapter" data-level="6.5.2" data-path="developing-with-a-frame.html"><a href="developing-with-a-frame.html#finding-community-components"><i class="fa fa-check"></i><b>6.5.2</b> Finding Community Components</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="developing-with-a-frame.html"><a href="developing-with-a-frame.html#summary-1"><i class="fa fa-check"></i><b>6.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><i class="fa fa-check"></i><b>7</b> Introduction to 3D and mesh forms of spatial data</a><ul>
<li class="chapter" data-level="7.1" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#questions-4"><i class="fa fa-check"></i><b>7.1</b> Questions</a></li>
<li class="chapter" data-level="7.2" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#overview-4"><i class="fa fa-check"></i><b>7.2</b> Overview</a></li>
<li class="chapter" data-level="7.3" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#what-is-a-mesh"><i class="fa fa-check"></i><b>7.3</b> What is a mesh?</a></li>
<li class="chapter" data-level="7.4" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#topology-vs.geometry"><i class="fa fa-check"></i><b>7.4</b> Topology vs. geometry</a></li>
<li class="chapter" data-level="7.5" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#geospatial-data"><i class="fa fa-check"></i><b>7.5</b> Geospatial data</a></li>
<li class="chapter" data-level="7.6" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#what-is-a-raster"><i class="fa fa-check"></i><b>7.6</b> What is a raster?</a></li>
<li class="chapter" data-level="7.7" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#what-is-a-polygon"><i class="fa fa-check"></i><b>7.7</b> What is a polygon?</a></li>
<li class="chapter" data-level="7.8" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#whats-the-fill"><i class="fa fa-check"></i><b>7.8</b> What’s the fill?</a></li>
<li class="chapter" data-level="7.9" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#primitives"><i class="fa fa-check"></i><b>7.9</b> Primitives</a></li>
<li class="chapter" data-level="7.10" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#raster-and-vector-are-not-a-strong-distinction-when-it-comes-to-meshes"><i class="fa fa-check"></i><b>7.10</b> Raster and vector are not a strong distinction when it comes to meshes</a></li>
<li class="chapter" data-level="7.11" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#the-rgl-mesh3d-format"><i class="fa fa-check"></i><b>7.11</b> the rgl mesh3d format</a></li>
<li class="chapter" data-level="7.12" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#details-of-the-mesh3d-format"><i class="fa fa-check"></i><b>7.12</b> Details of the mesh3d format</a></li>
<li class="chapter" data-level="7.13" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#quadmesh-and-coordinate-systems"><i class="fa fa-check"></i><b>7.13</b> Quadmesh and coordinate systems</a></li>
<li class="chapter" data-level="7.14" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#summary-2"><i class="fa fa-check"></i><b>7.14</b> Summary</a></li>
<li class="chapter" data-level="7.15" data-path="introduction-to-3d-and-mesh-forms-of-spatial-data.html"><a href="introduction-to-3d-and-mesh-forms-of-spatial-data.html#rgl-miscellanea"><i class="fa fa-check"></i><b>7.15</b> rgl miscellanea</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="transforming-spatial-data-to-3d-forms.html"><a href="transforming-spatial-data-to-3d-forms.html"><i class="fa fa-check"></i><b>8</b> Transforming spatial data to 3D forms</a><ul>
<li class="chapter" data-level="8.1" data-path="transforming-spatial-data-to-3d-forms.html"><a href="transforming-spatial-data-to-3d-forms.html#questions-5"><i class="fa fa-check"></i><b>8.1</b> Questions</a></li>
<li class="chapter" data-level="8.2" data-path="transforming-spatial-data-to-3d-forms.html"><a href="transforming-spatial-data-to-3d-forms.html#overview-5"><i class="fa fa-check"></i><b>8.2</b> Overview</a></li>
<li class="chapter" data-level="8.3" data-path="transforming-spatial-data-to-3d-forms.html"><a href="transforming-spatial-data-to-3d-forms.html#transforming-spatial-data-using-modular-3d-tools"><i class="fa fa-check"></i><b>8.3</b> Transforming Spatial Data using modular 3D tools</a></li>
<li class="chapter" data-level="8.4" data-path="transforming-spatial-data-to-3d-forms.html"><a href="transforming-spatial-data-to-3d-forms.html#on-cran"><i class="fa fa-check"></i><b>8.4</b> On CRAN</a></li>
<li class="chapter" data-level="8.5" data-path="transforming-spatial-data-to-3d-forms.html"><a href="transforming-spatial-data-to-3d-forms.html#stuff-not-on-cran"><i class="fa fa-check"></i><b>8.5</b> Stuff not on CRAN!</a></li>
<li class="chapter" data-level="8.6" data-path="transforming-spatial-data-to-3d-forms.html"><a href="transforming-spatial-data-to-3d-forms.html#triangles-or-quads-in-hypertidy-wip"><i class="fa fa-check"></i><b>8.6</b> Triangles or quads in hypertidy (WIP)</a></li>
<li class="chapter" data-level="8.7" data-path="transforming-spatial-data-to-3d-forms.html"><a href="transforming-spatial-data-to-3d-forms.html#create-and-texture-a-3d-mesh"><i class="fa fa-check"></i><b>8.7</b> Create and texture a 3D mesh</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="spatial-data-to-vr-via-r.html"><a href="spatial-data-to-vr-via-r.html"><i class="fa fa-check"></i><b>9</b> Spatial Data to VR via R</a><ul>
<li class="chapter" data-level="9.1" data-path="spatial-data-to-vr-via-r.html"><a href="spatial-data-to-vr-via-r.html#motivation"><i class="fa fa-check"></i><b>9.1</b> Motivation</a></li>
<li class="chapter" data-level="9.2" data-path="spatial-data-to-vr-via-r.html"><a href="spatial-data-to-vr-via-r.html#r-to-vr"><i class="fa fa-check"></i><b>9.2</b> R to VR</a><ul>
<li class="chapter" data-level="9.2.1" data-path="spatial-data-to-vr-via-r.html"><a href="spatial-data-to-vr-via-r.html#r2vr-hello-world"><i class="fa fa-check"></i><b>9.2.1</b> r2vr Hello World</a></li>
<li class="chapter" data-level="9.2.2" data-path="spatial-data-to-vr-via-r.html"><a href="spatial-data-to-vr-via-r.html#r2vr-tips"><i class="fa fa-check"></i><b>9.2.2</b> R2VR tips</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="spatial-data-to-vr-via-r.html"><a href="spatial-data-to-vr-via-r.html#spatial-data-in-vr"><i class="fa fa-check"></i><b>9.3</b> Spatial data in VR</a><ul>
<li class="chapter" data-level="9.3.1" data-path="spatial-data-to-vr-via-r.html"><a href="spatial-data-to-vr-via-r.html#dem-raster-to-vr"><i class="fa fa-check"></i><b>9.3.1</b> DEM raster to VR</a></li>
<li class="chapter" data-level="9.3.2" data-path="spatial-data-to-vr-via-r.html"><a href="spatial-data-to-vr-via-r.html#plotting-vr-elements-over-a-spatial-mesh"><i class="fa fa-check"></i><b>9.3.2</b> Plotting VR elements over a spatial mesh</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Git for Scientists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatial-data-to-vr-via-r" class="section level1">
<h1><span class="header-section-number">9</span> Spatial Data to VR via R</h1>
<ul>
<li>How do I create an A-Frame scene with R?</li>
<li>What kinds of data can we represent in A-Frame?</li>
<li>How do I render spatial data in VR?</li>
</ul>
<div id="motivation" class="section level2">
<h2><span class="header-section-number">9.1</span> Motivation</h2>
<p>So now you’ve had a taste of the A-Frame framework and marshalling spatial data to 3D in R
you’re in better position to undstand why defining VR scenes from R is a
beneficial thing. Before this capability existed the workflow for VR scenes was roughly this:</p>
<p>Repeat until ‘done’:</p>
<ol style="list-style-type: decimal">
<li>Build 3D models and JSON data in R for export to VR</li>
<li>Define VR in HTML/JS</li>
<li>Serve scene</li>
<li>Discover limitation or bug</li>
</ol>
<p>The process is naturally iterative but the speed of iteration is frustratingly
slow due to context switching from the R environment to Web environment. It also
leads to a nasty anti-pattern where data names and calculation results from
R make their way into web land as magical constants, slowing the process
even further when these need to change.</p>
</div>
<div id="r-to-vr" class="section level2">
<h2><span class="header-section-number">9.2</span> R to VR</h2>
<p>The tools that exist in R allow you to mix R code with the VR abstraction
provided by A-Frame. They do not provide a higher level abstraction. To use an R
analogy:</p>
<p><code>grid</code> is a low level graphics framework that gives you the power to draw
anything you can imagine using 2D geometric primitives. It is up to you write
functions that map your data to those primitives. <code>ggplot2</code> is a popular
visualisation package that does exactly this.</p>
<p>If you’re using VR tools in R you’re going to be working with low level VR
primitives. Do not expect <code>ggplot2</code> level magic. A typical scene will be hundreds
of lines of code, as opposed to say tens with <code>ggplot2</code>. The saving grace is
that most of those lines of code will be about declaring simple primitive
objects and interactions which are not overly complex.</p>
<p>This is a natural situation since the domain of VR visualisations is not well
understood right now. Through working with VR you will begin to see the common
tasks important to your domain and if we’re lucky you might even write a package
to help others do them.</p>
<p>There are currently two packages that allow you create A-Frame scenes in R:</p>
<ul>
<li><a href="https://github.com/milesmcbain/r2vr">r2vr</a> - used in this workshop</li>
<li><a href="https://github.com/JohnCoene/aframer">aframer</a></li>
</ul>
<p>They have different capabilities, APIs, and are not interoperable.</p>
<div id="r2vr-hello-world" class="section level3">
<h3><span class="header-section-number">9.2.1</span> r2vr Hello World</h3>
<p>Here’s a familiar scene constructed with <code>r2vr</code>, we’ll build some simpler
examples soon, this is just to compare and contrast the syntax:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(r2vr)

<span class="co">## Configure scene</span>

js_libs &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;https://unpkg.com/aframe-animation-component@^4.1.2/dist/aframe-animation-component.min.js&quot;</span>,
                <span class="st">&quot;https://unpkg.com/aframe-mirror-component/dist/aframe-mirror-component.min.js&quot;</span>
)

hadley_gif &lt;-<span class="st"> </span><span class="kw">a_asset</span>(<span class="dt">.tag =</span> <span class="st">&quot;img&quot;</span>,
                      <span class="dt">src =</span> <span class="st">&quot;./figs/JT_R_code.gif&quot;</span>,
                      <span class="dt">id =</span> <span class="st">&quot;hadz&quot;</span>)

box &lt;-<span class="st"> </span><span class="kw">a_entity</span>(<span class="dt">.tag =</span> <span class="st">&quot;box&quot;</span>,
                <span class="dt">position =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.5</span>, <span class="dv">-3</span>),
                <span class="dt">rotaion =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">45</span>, <span class="dv">0</span>),
                <span class="dt">src =</span> hadley_gif,
                <span class="dt">shadow =</span> <span class="st">&quot;&quot;</span>,
                <span class="dt">animation =</span>
                  <span class="kw">list</span>(<span class="dt">property =</span> <span class="st">&quot;rotation&quot;</span>,
                       <span class="dt">to =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">360</span>, <span class="dv">0</span>),
                       <span class="dt">dur =</span> <span class="dv">2000</span>,
                       <span class="dt">loop =</span> <span class="ot">TRUE</span>,
                       <span class="dt">easing =</span> <span class="st">&quot;linear&quot;</span>))

sphere &lt;-<span class="st"> </span><span class="kw">a_entity</span>(<span class="dt">.tag =</span> <span class="st">&quot;sphere&quot;</span>,
                   <span class="dt">position =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">1.25</span>, <span class="dv">-5</span>),
                   <span class="dt">radius =</span> <span class="fl">1.25</span>,
                   <span class="dt">color =</span> <span class="st">&quot;#EF2D5E&quot;</span>,
                   <span class="dt">shadow =</span> <span class="st">&quot;&quot;</span>,
                   <span class="dt">mirror =</span> <span class="kw">list</span>(<span class="dt">resolution =</span> <span class="dv">64</span>,
                                 <span class="dt">interval =</span> <span class="dv">150</span>,
                                 <span class="dt">distance =</span> <span class="dv">5000</span>,
                                 <span class="st">`</span><span class="dt">repeat</span><span class="st">`</span> =<span class="st"> </span><span class="ot">TRUE</span>))

cylinder &lt;-<span class="st"> </span><span class="kw">a_entity</span>(<span class="dt">.tag =</span> <span class="st">&quot;cylinder&quot;</span>,
                     <span class="dt">position =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.75</span>, <span class="dv">-3</span>),
                     <span class="dt">radius =</span> <span class="fl">0.5</span>,
                     <span class="dt">height =</span> <span class="fl">1.5</span>,
                     <span class="dt">color =</span> <span class="st">&quot;#FFC65D&quot;</span>,
                     <span class="dt">shadow =</span> <span class="st">&quot;&quot;</span>)

floor &lt;-<span class="st"> </span><span class="kw">a_entity</span>(<span class="dt">.tag =</span> <span class="st">&quot;plane&quot;</span>,
                  <span class="dt">position =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">-4</span>),
                  <span class="dt">rotation =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">90</span>, <span class="dv">0</span>, <span class="dv">0</span>),
                  <span class="dt">width =</span> <span class="dv">4</span>,
                  <span class="dt">height =</span> <span class="dv">4</span>,
                  <span class="dt">color =</span> <span class="st">&quot;#7BC8A4&quot;</span>,
                  <span class="dt">shadow =</span> <span class="st">&quot;&quot;</span>)

backboard &lt;-<span class="st"> </span><span class="kw">a_entity</span>(<span class="dt">.tag =</span> <span class="st">&quot;plane&quot;</span>,
                      <span class="dt">position =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">-6</span>),
                      <span class="dt">rotation =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),
                      <span class="dt">width =</span> <span class="dv">4</span>,
                      <span class="dt">height =</span> <span class="dv">4</span>,
                      <span class="dt">color =</span> <span class="st">&quot;#7BC8A4&quot;</span>,
                      <span class="dt">shadow =</span> <span class="st">&quot;&quot;</span>)

sky &lt;-<span class="st"> </span><span class="kw">a_entity</span>(<span class="dt">.tag =</span> <span class="st">&quot;sky&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;#ECECEC&quot;</span>)

hello_world_scene &lt;-<span class="st"> </span><span class="kw">a_scene</span>(<span class="dt">.template =</span> <span class="st">&quot;empty&quot;</span>,
                             <span class="dt">.children =</span> <span class="kw">list</span>(box, sphere, cylinder,
                                              floor, backboard, sky),
                             <span class="dt">.js_sources =</span> js_libs)

<span class="co">## Serve a scene</span>
hello_world_scene<span class="op">$</span><span class="kw">serve</span>()

<span class="co">## Stop serving a scene</span>
hello_world_scene<span class="op">$</span><span class="kw">stop</span>()</code></pre>
<p>This is the equivalent A-Frame scene: <a href="https://glitch.com/edit/#!/pricey-kitten" class="uri">https://glitch.com/edit/#!/pricey-kitten</a></p>
<p>Things to note:</p>
<ul>
<li>Components that were configured as HTML properties are now function arguments.</li>
<li><code>r2vr</code> has just one function for creating entities, <code>a_entity()</code>, that creates <code>&lt;a-entity&gt;</code> HTML. It can create the shorthand modes, eg <code>&lt;a-box&gt;</code>, using the <code>.tag</code> argument.</li>
<li>The convention with argument names is anything that will appear in HTML literally is a plain argument, anything that is internal to <code>r2vr</code> has a <code>.</code> prefix.</li>
<li>assets can be passed directly to entities, no need for the make the `#** id referencealthough assets still need ids.</li>
<li>The Hadley spinnig uses the animation component.</li>
</ul>
</div>
<div id="r2vr-tips" class="section level3">
<h3><span class="header-section-number">9.2.2</span> R2VR tips</h3>
<p><code>r2vr</code> is an A-Frame html code generator and server that users 3 main R6 classes created with <code>a_entity()</code>, <code>a_asset()</code> and <code>a_scene()</code>. You can view the HTML associated with these objects by calling their <code>render()</code> method. eg:</p>
</div>
</div>
<div id="spatial-data-in-vr" class="section level2">
<h2><span class="header-section-number">9.3</span> Spatial data in VR</h2>
<p>The type of work we will consider is making and plotting over 3D meshes. Recapping from the previous Act, the data types that are useful for this are:</p>
<ul>
<li>Rasters
<ul>
<li>Digital Elevation Modes give us mesh heights,</li>
<li>Images can give us textures</li>
<li>Model output to shade meshes</li>
</ul></li>
<li>Simple features collections
<ul>
<li>Giving us shapes for mesh boundaries</li>
</ul></li>
</ul>
<p>The R packages we will use to get these data into VR are:</p>
<ul>
<li><code>raster</code></li>
<li><code>sf</code></li>
<li><code>tidyverse</code></li>
<li><code>quashmesh</code></li>
<li><code>r2vr.gis</code></li>
<li><code>r2vr</code></li>
</ul>
<div id="dem-raster-to-vr" class="section level3">
<h3><span class="header-section-number">9.3.1</span> DEM raster to VR</h3>
<p>For this example we will use a DEM dataset from Uluṟu-Kata Tut National Park.</p>
<div id="load-raster" class="section level4">
<h4><span class="header-section-number">9.3.1.1</span> Load Raster</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raster)
<span class="kw">library</span>(quadmesh)

uluru_raster &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;./data/ELVIS_CLIP.tif&quot;</span>)

<span class="kw">plot</span>(uluru_raster)
<span class="kw">crs</span>(uluru_raster)
<span class="co">## CRS arguments:</span>
<span class="co">## +proj=lcc +lat_1=-30 +lat_2=-20 +lat_0=-25 +lon_0=135 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 </span></code></pre>
<p><strong>Check:</strong> Does the raster have <code>units=m</code>?</p>
<ul>
<li>When we port the mesh to VR we want it to
have units of meters since this is VCR’s native unit. Consider re-projecting if need be.</li>
</ul>
</div>
<div id="crop-raster" class="section level4">
<h4><span class="header-section-number">9.3.1.2</span> Crop Raster</h4>
<p>We’ll be doing a smaller section to make things faster</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(r2vr.gis)
<span class="kw">library</span>(sf)

<span class="co">### coords come from a google map: https://drive.google.com/open?id=1Ak26Hyx1R-f2QjPCTK0rQLye5xcHyE8n&amp;usp=sharing</span>

uluru_bbox &lt;-
<span class="st">  </span><span class="kw">st_bbox</span>(<span class="kw">c</span>(<span class="dt">xmin =</span> <span class="fl">131.02084</span>,
            <span class="dt">xmax =</span> <span class="fl">131.0535</span>,
            <span class="dt">ymin =</span> <span class="fl">-25.35461</span>,
            <span class="dt">ymax =</span> <span class="fl">-25.33568</span>),
          <span class="dt">crs =</span> <span class="kw">st_crs</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84&quot;</span>))
 
 uluru_raster &lt;-<span class="st"> </span><span class="kw">raster_crop_bbox</span>(uluru_raster, uluru_bbox)</code></pre>
</div>
<div id="make-triangular-mesh" class="section level4">
<h4><span class="header-section-number">9.3.1.3</span> Make Triangular Mesh</h4>
<p>We build a mesh using <code>quadmesh</code> and then cut each face in half so that it is a
triangular mesh. A-Frame models can only have triangular faces.</p>
<pre class="sourceCode r"><code class="sourceCode r">uluru_mesh &lt;-<span class="st"> </span><span class="kw">quadmesh</span>(uluru_raster)
rgl<span class="op">::</span><span class="kw">shade3d</span>(uluru_mesh)
<span class="co">## looks good?</span>

<span class="co">## quadmesh::triangulate quads will make a mesh that VR thinks is inside out.</span>
<span class="co">## This will be fixed in future.</span>

uluru_trimesh_indices &lt;-<span class="st"> </span><span class="kw">triangulate_quads</span>(uluru_mesh<span class="op">$</span>ib, <span class="dt">clockwise =</span> <span class="ot">FALSE</span>)</code></pre>
<p>We now have the pieces of a triangular mesh.</p>
<ul>
<li><code>uluru_mesh$vb</code> - are the mesh vertices and are actual points in space.</li>
<li><code>uluru_trimesh_indicies</code> - are indices into the vertices that describe triangles.</li>
</ul>
<p>Because we had the quad mesh expressed in this primitive form the transformation
could be made without creating any additional vertices. They are re-used for
triangles.</p>
</div>
<div id="export-to-3d-model-format" class="section level4">
<h4><span class="header-section-number">9.3.1.4</span> Export to 3D model format</h4>
<p>The 3D model format we will use is a JSON format supported by three.js but not
A-Frame natively. <code>r2vr</code> will take care of loading the 3rd party javascript
necessary to use models of this type.</p>
<p>When <a href="https://www.khronos.org/gltf/">gltf</a> support comes to R, that would be
preferred, but until then this is what we have.</p>
<p>Notice the use of <code>t()</code>. The VR tools expect columns of x, y, z coordinates
while <code>rgl</code> and <code>quadmesh</code> work in rows.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)

uluru_json &lt;-<span class="st"> </span><span class="kw">trimesh_to_threejson</span>(<span class="dt">vertices =</span> <span class="kw">t</span>(uluru_mesh<span class="op">$</span>vb[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, ]),
                                   <span class="dt">face_vertices =</span> <span class="kw">t</span>(uluru_trimesh_indices))

<span class="kw">write_file</span>(uluru_json, <span class="st">&quot;uluru.json&quot;</span>)</code></pre>
</div>
<div id="render-in-a-frame" class="section level4">
<h4><span class="header-section-number">9.3.1.5</span> Render in A-Frame</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(r2vr)

uluru_asset &lt;-<span class="st"> </span><span class="kw">a_asset</span>(<span class="dt">id =</span> <span class="st">&quot;uluru&quot;</span>, <span class="dt">src =</span> <span class="st">&quot;uluru.json&quot;</span>)

uluru_model &lt;-<span class="st"> </span><span class="kw">a_json_model</span>(<span class="dt">src =</span> uluru_asset)

scene &lt;-<span class="st"> </span><span class="kw">a_scene</span>(<span class="dt">.template =</span> <span class="st">&quot;basic_map&quot;</span>,
                 <span class="dt">.children =</span> <span class="kw">list</span>(uluru_model))
scene<span class="op">$</span><span class="kw">serve</span>()
<span class="co">## Fire started at 127.0.0.1:8080</span>

<span class="kw">a_kill_all_scenes</span>()</code></pre>
<p>If you navigate to <code>127.0.0.1:8080</code> in your browser you should see the scene being served. You can try it on your phone as well but you need to use your computer’s public IP scene$serve:</p>
<pre><code>scene$serve(host = &quot;&lt;YOUR_IP&gt;&quot;)</code></pre>
<p>If things are working you should see a scene empty but for a grey grid. This
grid is part of the <code>&quot;basic_map&quot;</code> template - it is added in automatically. It’s a
visual reference as each square is 1x1 VR meters. It also let’s you know that
things are ‘working’ - although Uluru is not visible at the moment.</p>
</div>
<div id="find-uluru" class="section level4 exercise">
<h4><span class="header-section-number">9.3.1.6</span> Find Uluru</h4>
<p>We’ve imported a full scale model of Uluru in VR but we can’t see it just yet.</p>
<ol style="list-style-type: decimal">
<li>Use the A-Frame inspector to find an appropriate, <code>scale</code>, <code>position</code>, <code>rotation</code>, and <code>color</code>, to view the model.</li>
</ol>
<p>Notice the position of the mesh, what does it say about how the coordinates have been transformed?</p>
</div>
<div id="setting-the-position-and-scale" class="section level4">
<h4><span class="header-section-number">9.3.1.7</span> Setting the position and scale</h4>
<p>From the previous exercise we learned that the model was too large to practically
view, was rotated with it’s z-axis pointing toward camera, and had been centred.</p>
<p>To keep it spatially referenced, it’s a good idea to set up some constants
relating to transforming the model to VR for example:</p>
<ul>
<li><code>scale_factor</code>
<ul>
<li>the scale of the model</li>
</ul></li>
<li><code>mesh_centre</code>
<ul>
<li>the centre of the original mesh so that we can use it to transform the coordinates of other things we would like to plot in spatial context over the mesh.</li>
</ul></li>
<li><code>height_correction</code>
<ul>
<li>the correction to apply to the height so that the ‘ground’ is at a VR height of 0.</li>
<li>This means we need to decide on what the true ground height should be. Here we use a simple approach of taking the lowest point in the raster extent.</li>
<li>We create this as an xyz vector so it can easily be added to positions.</li>
</ul></li>
</ul>
<p>We define these and view the result:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## Model constants</span>
scale_factor &lt;-<span class="st"> </span><span class="fl">0.01</span>

mesh_centre &lt;-<span class="st"> </span><span class="kw">colMeans</span>(<span class="kw">t</span>(uluru_mesh<span class="op">$</span>vb[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]))

extent_coord_mat &lt;-
<span class="st">  </span><span class="kw">matrix</span>(<span class="kw">extent</span>(uluru_raster),
         <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">FALSE</span>)

lowest_corner &lt;-<span class="st"> </span><span class="kw">min</span>(raster<span class="op">::</span><span class="kw">extract</span>(uluru_raster,
                                 extent_coord_mat))

height_correction &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, mesh_centre[<span class="dv">3</span>] <span class="op">-</span><span class="st"> </span>lowest_corner, <span class="dv">0</span>)

<span class="co">## Scene definition</span>
uluru_asset &lt;-<span class="st"> </span><span class="kw">a_asset</span>(<span class="dt">id =</span> <span class="st">&quot;uluru&quot;</span>, <span class="dt">src =</span> <span class="st">&quot;uluru.json&quot;</span>, <span class="dt">.parts =</span> <span class="st">&quot;uluru.png&quot;</span>)

uluru_model &lt;-<span class="st"> </span><span class="kw">a_json_model</span>(<span class="dt">src =</span> uluru_asset,
                            <span class="dt">scale =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>scale_factor,
                            <span class="dt">position =</span> (<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">-5</span>) <span class="op">+</span><span class="st"> </span>height_correction) <span class="op">*</span><span class="st"> </span>scale_factor,
                            <span class="dt">material =</span> <span class="kw">list</span>(<span class="dt">color =</span> <span class="st">&#39;#C88A77&#39;</span>),
                            <span class="dt">rotation =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">90</span>, <span class="dv">0</span>, <span class="dv">0</span>))

scene &lt;-<span class="st"> </span><span class="kw">a_scene</span>(<span class="dt">.template =</span> <span class="st">&quot;basic_map&quot;</span>,
                 <span class="dt">.children =</span> <span class="kw">list</span>(uluru_model))
scene<span class="op">$</span><span class="kw">serve</span>()

<span class="kw">a_kill_all_scenes</span>()</code></pre>
<p>It’s taking shape! But we can do better than plain brown.</p>
</div>
<div id="texturing-using-satellite-imagery" class="section level4">
<h4><span class="header-section-number">9.3.1.8</span> Texturing using satellite imagery</h4>
<p>We can use images to texture our mesh. This uses work we have done recently to make getting tiles from tile servers easier in R. The high level workflow is:</p>
<ol style="list-style-type: decimal">
<li>Fetch and composite satellite tiles for the mesh bounding box.</li>
<li>Rebuild mesh with <code>quadmesh</code> texture args, and export the model to supplying the texture coordinates with a reference to the texture image.</li>
</ol>
<div id="fetch-texture-image" class="section level5">
<h5><span class="header-section-number">9.3.1.8.1</span> Fetch texture image</h5>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## Fetch textures from ESRI maps</span>
<span class="co">## from slippymath README:</span>
<span class="kw">library</span>(purrr)
<span class="kw">library</span>(curl)
<span class="kw">library</span>(glue)
<span class="kw">library</span>(slippymath)

tile_grid &lt;-<span class="st"> </span><span class="kw">bb_to_tg</span>(uluru_bbox, <span class="dt">max_tiles =</span> <span class="dv">15</span>)

esri_query_string &lt;-
<span class="st">  </span><span class="kw">paste0</span>(<span class="st">&quot;https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{zoom}/{y}/{x}&quot;</span>)

images &lt;-
<span class="st">  </span><span class="kw">pmap</span>(tile_grid<span class="op">$</span>tiles,
       <span class="cf">function</span>(x, y, zoom){
         outfile &lt;-<span class="st"> </span><span class="kw">glue</span>(<span class="st">&quot;{x}_{y}.jpg&quot;</span>)
         <span class="kw">curl_download</span>(<span class="dt">url =</span> <span class="kw">glue</span>(esri_query_string),
                       <span class="dt">destfile =</span> outfile) 
         outfile 
       },
       <span class="dt">zoom =</span> tile_grid<span class="op">$</span>zoom)

<span class="co">## Create a new textured quamesh and export it to JSON</span>
raster_out &lt;-<span class="st"> </span><span class="kw">tg_composite</span>(tile_grid, images)

<span class="kw">raster_to_png</span>(raster_out, <span class="st">&quot;uluru.png&quot;</span>)

uluru_mesh_tex &lt;-<span class="st"> </span><span class="kw">quadmesh</span>(uluru_raster, <span class="dt">texture =</span> raster_out, <span class="dt">texture_filename =</span> <span class="st">&quot;uluru.png&quot;</span>)

uluru_trimesh_indices &lt;-<span class="st"> </span><span class="kw">triangulate_quads</span>(uluru_mesh_tex<span class="op">$</span>ib, <span class="dt">clockwise =</span> <span class="ot">FALSE</span>)

uluru_json &lt;-<span class="st"> </span><span class="kw">trimesh_to_threejson</span>(<span class="dt">vertices =</span> <span class="kw">t</span>(uluru_mesh_tex<span class="op">$</span>vb[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, ]),
                                   <span class="dt">face_vertices =</span> <span class="kw">t</span>(uluru_trimesh_indices),
                                   <span class="dt">vertex_uvs =</span> <span class="kw">t</span>(uluru_mesh_tex<span class="op">$</span>texcoords),
                                   <span class="dt">texture_file =</span> <span class="st">&quot;uluru.png&quot;</span>)

<span class="kw">write_file</span>(uluru_json, <span class="st">&quot;uluru.json&quot;</span>)

<span class="co">## Scene definition</span>
uluru_asset &lt;-<span class="st"> </span><span class="kw">a_asset</span>(<span class="dt">id =</span> <span class="st">&quot;uluru&quot;</span>, <span class="dt">src =</span> <span class="st">&quot;uluru.json&quot;</span>, <span class="dt">.parts =</span> <span class="st">&quot;uluru.png&quot;</span>)

uluru_model &lt;-<span class="st"> </span><span class="kw">a_json_model</span>(<span class="dt">src =</span> uluru_asset,
                            <span class="dt">scale =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>scale_factor,
                            <span class="dt">position =</span> (<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">-5</span>) <span class="op">+</span><span class="st"> </span>height_correction) <span class="op">*</span><span class="st"> </span>scale_factor,
                            <span class="dt">rotation =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">90</span>, <span class="dv">0</span>, <span class="dv">0</span>))
scene &lt;-<span class="st"> </span><span class="kw">a_scene</span>(<span class="dt">.template =</span> <span class="st">&quot;basic_map&quot;</span>,
                 <span class="dt">.children =</span> <span class="kw">list</span>(uluru_model))
scene<span class="op">$</span><span class="kw">serve</span>()

<span class="kw">a_kill_all_scenes</span>()</code></pre>
</div>
</div>
<div id="shading-using-data" class="section level4">
<h4><span class="header-section-number">9.3.1.9</span> Shading using data</h4>
<p>In this section we look at shading the mesh with an arbitrary raster. This could
represent the output of a spatial model.</p>
<p>We first generate a raster using a noise generator, we then use it to texture
the mesh.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ambient)
<span class="kw">library</span>(scico)

noise &lt;-
<span class="st">  </span><span class="kw">setExtent</span>(<span class="kw">raster</span>(<span class="kw">noise_simplex</span>(<span class="kw">c</span>(<span class="dv">500</span>, <span class="dv">600</span>),
                                 <span class="dt">fractal =</span> <span class="st">&quot;none&quot;</span>)),
            <span class="kw">extent</span>(uluru_raster))

colouring_raster_data &lt;-
<span class="st">  </span>raster<span class="op">::</span><span class="kw">extract</span>(noise, <span class="kw">t</span>(uluru_mesh_tex<span class="op">$</span>vb[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, ]))

n_colours &lt;-<span class="st"> </span><span class="dv">256</span>

palette_function &lt;-
<span class="st">  </span>purrr<span class="op">::</span><span class="kw">partial</span>(scico, <span class="dt">palette =</span> <span class="st">&quot;tokyo&quot;</span>)

vertex_colour_data &lt;-
<span class="st">  </span><span class="kw">vec_pal_colours</span>(colouring_raster_data,
                  palette_function,
                  n_colours,
                  <span class="dt">zero_index =</span> <span class="ot">TRUE</span>)

face_colours &lt;-
<span class="st">  </span><span class="kw">vertex_to_face_colours</span>(vertex_colour_data<span class="op">$</span>indexes,
                         <span class="kw">t</span>(uluru_trimesh_indices))
                         
mesh_json &lt;-
<span class="st">  </span><span class="kw">trimesh_to_threejson</span>(<span class="dt">vertices =</span> <span class="kw">t</span>(uluru_mesh<span class="op">$</span>vb[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]),
                       <span class="dt">face_vertices =</span> <span class="kw">t</span>(uluru_trimesh_indices),
                       <span class="dt">colours =</span> vertex_colour_data<span class="op">$</span>colours,
                       <span class="dt">face_vertex_colours =</span> face_colours)


<span class="co">## Scene definition</span>
uluru_asset_mod &lt;-<span class="st"> </span><span class="kw">a_in_mem_asset</span>(<span class="dt">id =</span> <span class="st">&quot;uluru_mod&quot;</span>, <span class="dt">src =</span> <span class="st">&quot;uluru_mod.json&quot;</span>, <span class="dt">.data =</span> mesh_json)

uluru_model2 &lt;-<span class="st"> </span><span class="kw">a_json_model</span>(<span class="dt">src =</span> uluru_asset_mod,
                            <span class="dt">material =</span> <span class="kw">list</span>(<span class="dt">src =</span> uluru_asset_mod, <span class="dt">opacity =</span> <span class="fl">0.5</span>),
                            <span class="dt">scale =</span> <span class="kw">c</span>(<span class="fl">1.001</span>, <span class="fl">1.001</span>, <span class="fl">1.001</span>) <span class="op">*</span><span class="st"> </span>scale_factor,
                            <span class="dt">position =</span> (<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">-5</span>) <span class="op">+</span><span class="st"> </span>height_correction) <span class="op">*</span><span class="st"> </span>scale_factor,
                            <span class="dt">rotation =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">90</span>, <span class="dv">0</span>, <span class="dv">0</span>))

scene &lt;-<span class="st"> </span><span class="kw">a_scene</span>(<span class="dt">.template =</span> <span class="st">&quot;basic_map&quot;</span>,
                 <span class="dt">.children =</span> <span class="kw">list</span>(uluru_model2))
scene<span class="op">$</span><span class="kw">serve</span>()

<span class="kw">a_kill_all_scenes</span>()

<span class="kw">plot</span>(<span class="kw">raster</span>(volcano), <span class="dt">col =</span> <span class="kw">scico</span>(<span class="dv">26</span>, <span class="dt">palette =</span> <span class="st">&quot;tokyo&quot;</span>))</code></pre>
</div>
</div>
<div id="plotting-vr-elements-over-a-spatial-mesh" class="section level3">
<h3><span class="header-section-number">9.3.2</span> Plotting VR elements over a spatial mesh</h3>
<div id="todo" class="section level4">
<h4><span class="header-section-number">9.3.2.1</span> TODO</h4>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="transforming-spatial-data-to-3d-forms.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

</body>

</html>
